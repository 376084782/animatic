(function(){function t(){this.handlers={}}function n(n,a,i,s,e){t.call(this),this.item=n,this.translate=a.translate,this.rotate=a.rotate,this.scale=a.scale,this.start=null,this.duration=i||500,this.delay=e||0,this.easing=r[s]||r.linear}function a(t){this.items=t||[],this.init()}function i(n){t.call(this),this.dom=n,this.animations=[],this._dirty=!1,this.init()}window.anima={init:function(){return this.world=new a,this.world}};var r=function(){var t={quad:function(t){return Math.pow(t,2)},cubic:function(t){return Math.pow(t,2)},quart:function(t){return Math.pow(t,4)},quint:function(t){return Math.pow(t,5)},expo:function(t){return Math.pow(t,6)},sine:function(t){return 1-Math.cos(t*Math.PI/2)},circ:function(t){return 1-Math.sqrt(1-t*t)},back:function(t){return t*t*(3*t-2)}},n={linear:function(t){return t}};return Object.keys(t).forEach(function(a){var i=t[a];n["ease-in-"+a]=i,n["ease-out-"+a]=function(t){return 1-i(1-t)},n["ease-in-out-"+a]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}}),n}();t.prototype.on=function(t,n){return(this.handlers[t]=this.handlers[t]||[]).push(n),this},t.prototype.off=function(t,n){var a=this.handlers[t];return n?a.splice(a.indexOf(n),1):a=[],this},t.prototype.emit=function(t){var n,a=Array.prototype.slice.call(arguments,1),i=this.handlers[t];if(i){n=i.length;for(var r=0;n>r;++r)i[r].apply(this,a)}return this},n.prototype=new t,n.prototype.constructor=n,n.prototype.init=function(){if(null===this.start){this.start=Date.now();var t=this.item.state;this.initial={translate:t.translate,rotate:t.rotate,scale:t.scale}}},n.prototype.animation=function(){return this.item.animation.apply(this.item,arguments)},n.prototype.run=function(t){var n=(t-this.start)/this.duration;0>n&&(n=0),n=this.easing(n),this.transform(n)},n.prototype.transform=function(t){var n=this.item.state,a=this.initial;this.translate&&(this.translate[0]||this.translate[1]||this.translate[2])&&(n.translate=[a.translate[0]+this.translate[0]*t,a.translate[1]+this.translate[1]*t,a.translate[2]+this.translate[2]*t]),this.rotate&&(this.rotate[0]||this.rotate[1]||this.rotate[2])&&(n.rotate=[a.rotate[0]+this.rotate[0]*t,a.rotate[1]+this.rotate[1]*t,a.rotate[2]+this.rotate[2]*t]),this.scale&&(this.scale[0]||this.scale[1]||this.scale[2])&&(n.scale=[a.scale[0]+this.scale[0]*t,a.scale[1]+this.scale[1]*t,a.scale[2]+this.scale[2]*t])},n.prototype.end=function(t){!t&&this.transform(1),this.emit("end")},a.prototype.init=function(){var t=this,n=window.requestAnimationFrame||window.webkitRequestAnimationFrame;n(function a(i){t.update(i),n(a)})},a.prototype.add=function(t){var n=new i(t);return this.items.push(n),n},a.prototype.update=function(t){for(var n=0,a=this.items.length;a>n;n++)this.items[n].update(t)},a.prototype.on=function(t,n){window.addEventListener(t,n)};var s=window.Matrix=function(){function t(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function n(t,a){var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];return i[0]=t[0]*a[0]+t[1]*a[4]+t[2]*a[8],i[1]=t[0]*a[1]+t[1]*a[5]+t[2]*a[9],i[2]=t[0]*a[2]+t[1]*a[6]+t[2]*a[10],i[4]=t[4]*a[0]+t[5]*a[4]+t[6]*a[8],i[5]=t[4]*a[1]+t[5]*a[5]+t[6]*a[9],i[6]=t[4]*a[2]+t[5]*a[6]+t[6]*a[10],i[8]=t[8]*a[0]+t[9]*a[4]+t[10]*a[8],i[9]=t[8]*a[1]+t[9]*a[5]+t[10]*a[9],i[10]=t[8]*a[2]+t[9]*a[6]+t[10]*a[10],i[12]=t[12]*a[0]+t[13]*a[4]+t[14]*a[8]+a[12],i[13]=t[12]*a[1]+t[13]*a[5]+t[14]*a[9]+a[13],i[14]=t[12]*a[2]+t[13]*a[6]+t[14]*a[10]+a[14],2>=arguments.length?i:n.apply(null,[i].concat(v.call(arguments,2)))}function a(t,n,a){return t||(t=0),n||(n=0),a||(a=0),[1,0,0,0,0,1,0,0,0,0,1,0,t,n,a,1]}function i(t){return a(t,0,0)}function r(t){return a(0,t,0)}function s(t){return a(0,0,t)}function e(t,n,a){return t||(t=0),n||(n=t),a||(a=1),[t,0,0,0,0,n,0,0,0,0,a,0,0,0,0,1]}function o(t,n,a){t||(t=0),n||(n=0),a||(a=0),t*=w,n*=w,a*=w;var i=Math.sin(t),r=Math.cos(t),s=Math.sin(n),e=Math.cos(n),o=Math.sin(a),h=Math.cos(a);return[e*h,r*o+i*s*h,i*o-r*s*h,0,-e*o,r*h-i*s*o,i*h+r*s*o,0,s,-i*e,r*e,0,0,0,0,1]}function h(t){t*=w;var n=Math.sin(t),a=Math.cos(t);return[1,0,0,0,0,a,n,0,0,-n,a,0,0,0,0,1]}function u(t){t*=w;var n=Math.sin(t),a=Math.cos(t);return[a,0,-n,0,0,1,0,0,n,0,a,0,0,0,0,1]}function c(t){t*=w;var n=Math.sin(t),a=Math.cos(t);return[a,n,0,0,-n,a,0,0,0,0,1,0,0,0,0,1]}function l(t,n,a,i){i*=w;var r=Math.sin(i),s=Math.cos(i),e=Math.sqrt(t*t+n*n+a*a);0===e?(t=0,n=0,a=1):1!==e&&(t/=e,n/=e,a/=e);var o=t*t,h=n*n,u=a*a,c=1-s;return[o+(1-o)*s,t*n*c+a*r,t*a*c-n*r,0,t*n*c-a*r,h+(1-h)*s,n*a*c+t*r,0,t*a*c+n*r,n*a*c-t*r,u+(1-u)*s,0,0,0,0,1]}function f(t,n){return t*=w,n*=w,[1,Math.tan(n),0,0,Math.tan(t),1,0,0,0,0,1,0,0,0,0,1]}function p(t){return f(t,0)}function m(t){return f(0,t)}function y(t){return t=-1/t,[1,0,0,0,0,1,0,0,0,0,1,t,0,0,0,1]}function d(t){for(var n=0,a=t.length;a>n;++n)1e-6>Math.abs(t[n])&&(t[n]=0);return"matrix3d("+t.join()+")"}var v=Array.prototype.slice,w=Math.PI/180;return{toString:d,id:t,multiply:n,rotate:o,rotate3d:l,rotateX:h,rotateY:u,rotateZ:c,translate:a,translateX:i,translateY:r,translateZ:s,perspective:y,skew:f,skewX:p,skewY:m,scale:e}}();i.prototype=new t,i.prototype.constructor=i,i.prototype.init=function(){this.state={translate:[0,0,0],rotate:[0,0,0],scale:[1,1,1]},this.transform={translate:[0,0,0],rotate:[0,0,0],scale:[0,0,0]},this.on("transform",function(t,n,a){this.transform.translate=t,this.transform.rotate=n,this.transform.scale=a,this._dirty=!0})},i.prototype.update=function(t){var n=this;this.animate(t),this.dom.style.webkitTransform=s.toString(s.multiply.apply(null,Object.keys(n.state).map(function(t){return s[t].apply(null,n.state[t])})))},i.prototype.translate=function(t){this.state.translate[0]+=t[0],this.state.translate[1]+=t[1],this.state.translate[2]+=t[2]},i.prototype.rotate=function(t){this.state.rotate[0]+=t[0],this.state.rotate[1]+=t[1],this.state.rotate[2]+=t[2]},i.prototype.scale=function(t){this.state.scale[0]+=t[0],this.state.scale[1]+=t[1],this.state.scale[2]+=t[2]},i.prototype.clear=function(){this.state.translate=[0,0,0],this.state.rotate=[0,0,0],this.state.scale=[0,0,0]},i.prototype.anim=i.prototype.animation=function(t,a,i){var r=new n(this,t,a,i);return this.animations.push(r),this.transform={translate:[0,0,0],rotate:[0,0,0],scale:[0,0,0]},r},i.prototype.animate=function(t){if(0===this.animations.length&&this._dirty&&(this.animation({translate:this.transform.translate,rotate:this.transform.rotate}),this._dirty=!1),0!==this.animations.length)for(;0!==this.animations.length;){var n=this.animations[0];n.init();{if(!(n.start+n.duration<=Date.now())){n.run(t);break}this.animations.shift(),n.end()}}},i.prototype.reset=function(){if(0!==this.animations.length){for(var t=0,n=this.animations.length;n>t;t++){var a=this.animations[t];a.end(!0)}this.animations=[],this.transform={translate:[0,0,0],rotate:[0,0,0],scale:[0,0,0]}}}})();